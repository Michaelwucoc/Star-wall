{include file="LoveLink/public/header"}
<div id="jsParameter" jsPageHierarchy=1 jsTabClass="{if $cardsModel == 0}2{else}1{/if}" class="content-page">
   <div class="container-fluid">
      <div class="row">
         <div class="col-sm-12 col-lg-6 col-md-6">
            <div class="card">
               <div class="card-header d-flex justify-content-between">
                  <div class="header-title">
                     <h4 class="card-title">æ·»åŠ äº¤æµå¡</h4>
                  </div>
               </div>
               <div class="card-body">
                  <label for="basic-url">Noticeï¼š*ä¸ºå¿…å¡«é¡¹</label>
                  <div class="input-group mb-4">
                     <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">ğŸ˜</span>
                     </div>
                     <input type="text" id="woName" class="form-control" placeholder="ä½ çš„ç§°å‘¼" aria-label="ä½ çš„ç§°å‘¼"
                        aria-describedby="basic-addon1">
                  </div>
                  <div class="input-group mb-4">
                     <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">QQ</span>
                     </div>
                     <input type="text" id="woContact" class="form-control" placeholder="è”ç³»æ–¹å¼" aria-label="è”ç³»æ–¹å¼"
                        aria-describedby="basic-addon1">
                  </div>
                  <div class="input-group mb-4">
                     <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">@</span>
                     </div>
                     <input type="text" id="taName" class="form-control" placeholder="TAçš„å§“å(ä¸è°äº¤æµ)"
                        aria-label="TAçš„å§“å(ä¸è°äº¤æµ)" aria-describedby="basic-addon1">
                  </div>
                  <div class="input-group mb-4">
                     <div class="input-group-prepend">
                        <label class="input-group-text" for="inputGroupSelect01">æ ‡ç­¾</label>
                     </div>
                     <select class="custom-select" id="inputGroupSelect01">
                        {volist name="cardsTagData" id="data"}
                        <option value="{$data.id}">{$data.name}</option>
                        {/volist}
                     </select>
                  </div>
                  {if $cardsModel == 0}
                  <div class="input-group">
                     <div class="input-group-prepend">
                        <span class="input-group-text text-area">è¡¨ç™½å†™äº›ä»€ä¹ˆ*</span>
                     </div>
                     <textarea id="content" class="form-control" aria-label="è¡¨ç™½å†™äº›ä»€ä¹ˆ*"></textarea>
                  </div>
                  {else}
                  <div class="input-group mb-4">
                     <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">QQ</span>
                     </div>
                     <input type="text" id="taContact" class="form-control" placeholder="TAçš„è”ç³»æ–¹å¼" aria-label="TAçš„è”ç³»æ–¹å¼"
                        aria-describedby="basic-addon1">
                  </div>
                  <div class="input-group">
                     <div class="input-group-prepend">
                        <span class="input-group-text text-area">è¡¨ç™½å†™äº›ä»€ä¹ˆ*</span>
                     </div>
                     <textarea id="content" class="form-control" aria-label="è¡¨ç™½å†™äº›ä»€ä¹ˆ*"></textarea>
                  </div>
                  {/if}
                  <br>

                  <div id="model" value="{$cardsModel}" class="mdui-card-actions">
                     <button id="submitAdd" type="button"
                        class="btn btn-primary btn-block">æäº¤</button>
                  </div>
               </div>

            </div>
         </div>
         <div class="col-sm-12 col-lg-6 col-md-6">
            <div class="card">
               <div class="card-header d-flex justify-content-between">
                  <div class="header-title">
                     <h4 class="card-title">é™„åŠ é€‰é¡¹-å›¾ç‰‡</h4>
                  </div>
               </div>
               <div class="card-body">
                  <div id="listImageUrl">
                     <!-- å›¾ç‰‡å®¹å™¨ -->
                  </div>
                  
                  <div class="input-group mb-3" id="dialogUploadImage">
                        <div class="input-group-prepend">
                           <span class="input-group-text" id="basic-addon3">Url</span>
                        </div>
                        <input type="text" placeholder="æœ€å¤šä¸Šä¼ 9å¼ 10Må›¾ç‰‡ æˆ– http(s)://" class="form-control" id="urlUpdataImage" aria-describedby="basic-addon3">
                  </div>
                  <label id="btnUploadImage" class="btn btn-outline-secondary" >
                   <span>ç‚¹å‡»ä¸Šä¼ </span>
                   <input id="dataUpdataImage" type="file" style="display: none;" />
                  </label>
                  &ensp;
                  <button type="button" id="nwebtnUpdataImgUrl" class="btn btn-primary" data-toggle="button"
                     aria-pressed="false">
                     ç¡®è®¤æäº¤
                  </button>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>


{include file="LoveLink/public/public"}
<script src="{__A-assets__}/cardsEdit.js"></script>
{if $configData.geetest.DefSetValidatesStatus == 1}
<script src="https://static.geetest.com/v4/gt4.js"></script>
<script src="{__A-assets__}/gt4/base.js"></script>
{/if}
<script>
   //æŒ‰é’®-å›¾ç‰‡ä¸Šä¼ 
   $('#newbtnUploadImage').change(function () {
      var formData = new FormData();
      formData.append('file', dataUpdataImage.files[0]);
      $('#newbtnUploadImage').find('span').text('æ­£åœ¨ä¸Šä¼ ');
      //æäº¤æ•°æ®
      var result = apiAjax1(formData, apiUrlUploadImage, 'POST');
      if (result) {
         //æˆåŠŸ
         mdui.snackbar({
            message: 'ä¸Šä¼ æˆåŠŸ',
            position: 'left-top'
         });
         $('#urlUpdataImage').val('/storage/' + result.data);
         $('#newbtnUploadImage').find('span').text('/storage/' + result.data);
         return;
      } else {
         $('#newbtnUploadImage').find('span').text('ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•');
         return;
      }
   });

   //æŒ‰é’®-åŠ è½½å›¾ç‰‡ç»„ä»¶
   $('#nwebtnUpdataImgUrl').click(function () {
      var urlUpdataImage = $('#urlUpdataImage').val();
      console.log(checkChooseTagId)
      if (checkUrl(urlUpdataImage)) {
         //é™åˆ¶å›¾ç‰‡ä¸ªæ•°
         if ($('#listImageUrl').children().length >= DefSetCardsImgNum) {
            mdui.snackbar({
               message: 'è¶…è¿‡ä¸Šä¼ é™åˆ¶',
               position: 'left-top'
            });
            return;
         }
         //æ·»åŠ å›¾ç‰‡åˆ°ä½ç½®
         $('#listImageUrl').append(`
            <div class="mdui-col mdui-p-b-1">
                <div class="mdui-grid-tile">
                    <div class="css-cardsAdd-img">
                        <img class="js-url-UpdataImage" src="${urlUpdataImage}">
                        <div class="mdui-cardAdd-menu">
                            <button class="mdui-btn mdui-btn-icon js-btn-delete-UrlUpdataImage">
                                <i class="mdui-icon material-icons" style="padding:unset;">clear</i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `);
      } else {
         mdui.snackbar({
            message: 'URLä¸åˆæ³•ï¼Œè¯·é‡è¯•',
            position: 'left-top'
         });
      }
      //é‡ç½®Urlè¾“å…¥æ¡†
      $('#urlUpdataImage').val('');
      //åˆ é™¤æŒ‰é’®å†æ¬¡åˆå§‹åŒ–
      $('.js-btn-delete-UrlUpdataImage').click(function () {
         $(this).parent().parent().parent().parent().remove();
      });
   })

   $(function () {
      //æäº¤
      const FunResultAdd = (CaptchaData) => {
         //æ˜¯å¦å­˜åœ¨éªŒè¯å‚æ•°
         var data;
         if (CaptchaData) { data = CaptchaData; }

         //æ„å»ºå›¾ç‰‡urlæ•°ç»„å¹¶è·å–
         var jsonImageUrl = [];
         $('#listImageUrl').find('.js-url-UpdataImage').each(function () {
            jsonImageUrl.push($(this).attr('src'));
         });
         img = JSON.stringify(jsonImageUrl);
         tag = JSON.stringify(checkChooseTagId);

         data = {
            ...data,//åˆå¹¶éªŒè¯å‚æ•°
            'content': $('#content').val(),
            'woName': $('#woName').val(),
            'taName': $('#taName').val(),
            'woContact': $('#woContact').val(),
            'taContact': $('#taContact').val(),
            'model': $('#model').attr('value'),
            'tag': tag,
            'img': img,
         };
         var result = apiAjax0a(data, apiUrlCardsAdd, 'POST');
         if (result['r']['ec'] == 200) {
            mdui.snackbar({
               message: 'æ·»åŠ æˆåŠŸ',
               position: 'left-top'
            });
            jumpUrl('/index/cards/card/id/' + result.r.data.id);
            return;
         } else if (result['r']['ec'] == 201) {
            jumpUrl('/index');
            return;
         }
      }
      //éªŒè¯
      /*{if $configData.geetest.DefSetValidatesStatus == 1}*/
      geetest4('#submitAdd', FunResultAdd, '{$configData.geetest.DefSetGeetestId}');
      /*{else /}*/
      $('#submitAdd').click(function () { FunResultAdd() });
      /*{/if}*/
   });
</script>
{include file="LoveLink/public/footer"}
</body>
</html>